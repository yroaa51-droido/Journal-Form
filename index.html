<!doctype html>
<html lang="ar">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>فورم الأسئلة مع عداد الكلمات</title>
<style>
  body {font-family: Tahoma, sans-serif; direction: rtl; padding: 20px; background:#f5f5f5;}
  h2 {color:#333;}
  label {display:block; margin-top:15px; font-weight:bold;}
  input, textarea {width:100%; padding:8px; margin-top:5px; font-family:inherit;}
  textarea {resize: vertical;}
  .counter {font-size:13px; color:#555;}
  .limit {color:#d00; font-weight:bold;}
  button {margin-top:20px; padding:10px 15px; background:#007bff; color:#fff; border:none; border-radius:5px; font-size:16px;}
  button:disabled {background:gray;}
  #timer {font-size:18px; color:#d00; margin-bottom:10px;}
</style>
</head>
<body>
  <h2>نموذج الإجابة</h2>
  <div id="timer">الوقت المتبقي: 60:00</div>

  <form id="examForm" autocomplete="off" spellcheck="false">
    <label>الاسم:
      <input type="text" name="name" required>
    </label>

    <label>It’s your first time to work in group to make a project. Illustrate two things you will do to be sure your group will be effective, showing the benefit of each of them:
      <textarea name="q1" rows="4" required></textarea>
      <div class="counter" id="count1">0 / 250 كلمة</div>
    </label>

    <label>In Egypt’s STEM education system, the engineering design process (EDP) is a thinking process used to learn and apply concepts and skills in an integrated manner. The first step of the EDP is defining the problem. Identify two reasons that make defining the right problem to solve important to the success of any project. Alternative: “Explain how a poorly defined problem could negatively impact two later steps in the engineering design process.”:
      <textarea name="q2" rows="4" required></textarea>
      <div class="counter" id="count2">0 / 250 كلمة</div>
    </label>

    <label>(Lo 1.01) You have studied SketchUp program. Select two most important tools in your opinion and explain how you can benefit from them in your Capstone project:
      <textarea name="q3" rows="4" required></textarea>
      <div class="counter" id="count3">0 / 250 كلمة</div>
    </label>

    <button type="submit">إرسال الإجابات</button>
  </form>

<script>
// 🔗 هنا تحط رابط Google Apps Script لما تنشره كـ Web App
const scriptURL = "PASTE_YOUR_SCRIPT_LINK_HERE";

// 🕒 عدّاد تنازلي لمدة ساعة
let totalSeconds = 60 * 60; // 60 دقيقة
let timerEl = document.getElementById("timer");
let form = document.getElementById("examForm");

function updateTimer() {
  if (totalSeconds <= 0) {
    clearInterval(countdown);
    form.querySelectorAll("input,textarea,button").forEach(e => e.disabled = true);
    timerEl.textContent = "⏰ انتهى الوقت — تم غلق النموذج";
    return;
  }
  totalSeconds--;
  let mm = String(Math.floor(totalSeconds / 60)).padStart(2, "0");
  let ss = String(totalSeconds % 60).padStart(2, "0");
  timerEl.textContent = الوقت المتبقي: ${mm}:${ss};
}

let countdown = setInterval(updateTimer, 1000);
updateTimer(); // لتحديث فوري عند التشغيل

// ✍ عدّاد الكلمات
function countWords(text) {
  return text.trim().split(/\s+/).filter(w => w.length > 0).length;
}

function setupCounter(textarea, counterId) {
  let counter = document.getElementById(counterId);
  textarea.addEventListener('input', () => {
    let words = countWords(textarea.value);
    counter.textContent = ${words} / 250 كلمة;
    if (words > 250) {
      counter.classList.add('limit');
      textarea.value = textarea.value.trim().split(/\s+/).slice(0, 250).join(" ");
      alert("❌ وصلت للحد الأقصى 250 كلمة!");
    } else {
      counter.classList.remove('limit');
    }
  });
}

setupCounter(form.q1, "count1");
setupCounter(form.q2, "count2");
setupCounter(form.q3, "count3");

// 🚀 إرسال البيانات إلى Google Sheet
form.addEventListener("submit", e => {
  e.preventDefault();
  const data = {
    name: form.name.value,
    q1: form.q1.value,
    q2: form.q2.value,
    q3: form.q3.value
  };
  fetch(scriptURL, {
    method: "POST",
    body: JSON.stringify(data)
  })
  .then(res => res.text())
  .then(msg => {
    alert("✅ تم إرسال الإجابات بنجاح!");
    form.reset();
    document.getElementById("count1").textContent = "0 / 250 كلمة";
    document.getElementById("count2").textContent = "0 / 250 كلمة";
    document.getElementById("count3").textContent = "0 / 250 كلمة";
  })
  .catch(err => {
    alert("حدث خطأ أثناء الإرسال ❌");
    console.error(err);
  });
});

// 🔒 منع النسخ واللصق والتصحيح
document.addEventListener('contextmenu', e => e.preventDefault());
form.addEventListener('paste', e => e.preventDefault());
form.addEventListener('copy', e => e.preventDefault());
</script>
</body>
</html>
